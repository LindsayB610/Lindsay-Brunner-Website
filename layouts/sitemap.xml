{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
{{- $sitemap := .Sitemap }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- range .Data.Pages }}
    {{- /* Exclude drafts */ -}}
    {{- if .Draft }}
      {{- continue }}
    {{- end }}
    {{- /* Exclude taxonomy pages that redirect (tags, categories) */ -}}
    {{- if or (hasPrefix .RelPermalink "/tags/") (hasPrefix .RelPermalink "/categories/") }}
      {{- continue }}
    {{- end }}
    
    {{- $priority := 0.5 }}
    {{- $changefreq := "monthly" }}
    
    {{- if .IsHome }}
      {{- $priority = 1.0 }}
      {{- $changefreq = "weekly" }}
    {{- else if eq .Kind "section" }}
      {{- $priority = 0.8 }}
      {{- $changefreq = "weekly" }}
    {{- else if .IsPage }}
      {{- $priority = 0.5 }}
      {{- $changefreq = "monthly" }}
    {{- end }}
    
    {{- $lastmod := "" }}
    {{- if not .Lastmod.IsZero }}
      {{- $lastmod = .Lastmod.Format "2006-01-02T15:04:05-07:00" }}
    {{- else if not .Date.IsZero }}
      {{- $lastmod = .Date.Format "2006-01-02T15:04:05-07:00" }}
    {{- end }}
    
  <url>
    <loc>{{ .Permalink }}</loc>
    {{- if $lastmod }}
    <lastmod>{{ $lastmod }}</lastmod>
    {{- end }}
    <changefreq>{{ $changefreq }}</changefreq>
    <priority>{{ $priority }}</priority>
  </url>
  {{- end }}
</urlset>

